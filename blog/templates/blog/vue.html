{% extends 'blog/base.html' %}
{% block content %}
<h3>Vue.js</h3>
<hr>
<div id="app">
    <game></game>
</div>
<script>
    Vue.component('Square',{
        props:['value'],
        methods:{
            setValue(){
                this.$emit('click');
            }
        },
        template:'<button class="square btn btn-default ttt" v-on:click="setValue" v-text="value"></button>',
    })

    Vue.component('Board',{
        data(){
            return {
               
                board : [[0,1,2],[3,4,5],[6,7,8]],
                squares:Array(9).fill(null),
                xIsNext:true,
                status : 'Next Player : X',
            }
        },
        methods:{
            handleClick(i){
                const squares = this.squares.slice();
                if(squares[i]){
                    return;
                }
                squares[i] = this.xIsNext ? 'X' : 'O';
                this.squares = squares;
                const winner = calculateWinner(squares);
                if(winner){
                    this.status = 'Winner : '+winner;
                    return;
                }
                this.xIsNext = !this.xIsNext;
                this.status = 'Next Player : '+(this.xIsNext ? 'X' : 'O')
            }
        },
        template:`<div><div class="status" v-text="status"></div>
                    <div class="board-row" v-for="(row,index) in board" :key="index">
                        <Square v-for="square in row" :key="square" :value="squares[square]" v-on:click="handleClick(square)"/>
                    </div>
                </div>`
    })

    Vue.component('Game',{
        template:`<div><Board/></div>`
    })

    new Vue({
        el:'#app',
    })

    function calculateWinner(squares) {
        const lines = [
            [0, 1, 2],
            [3, 4, 5],
            [6, 7, 8],
            [0, 3, 6],
            [1, 4, 7],
            [2, 5, 8],
            [0, 4, 8],
            [2, 4, 6],
        ];
        for (let i = 0; i < lines.length; i++) {
            const [a, b, c] = lines[i];
            if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {
                return squares[a];
            }
        }
        return null;
    }
</script>
{% endblock %}